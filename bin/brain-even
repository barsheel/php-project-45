#!/usr/bin/env php
<?php

/**
 * Brain-Even game
 * 
 * The user guesses the number is even or not
 */

namespace BrainGames\bin;

require_once __DIR__ . '/../vendor/autoload.php';

use function cli\line;
use function cli\prompt;
use function BrainGames\Cli\sayHello;

play(3);

/**
 * Main cycle of game. User have to introduce himself and answer for questions.
 * 
 * @param int $questionCount
 */
function play(int $questionCount): void {
    $name = sayHello();
    for($i = 0; $i < $questionCount; $i++) {
        if (!askQuestion($name)) {
            return;
        }
    }
    printWinMessage($name);
}

/**
 * Ask a question, print message and return boolean result
 * 
 * @param string $name - name of user, it needed for passing $name in message function
 * @return bool - correct or wrong answer
 */
function askQuestion(string $name): bool {
    $numberToAsk = random_int (0, 100);
    if ($numberToAsk %2 === 0) {
        $correctAnswer = "yes";
        $wrongAnswer = "no";
    } else {
        $correctAnswer = "no";
        $wrongAnswer = "yes";
    }

    line("Answer \"yes\" if the number is even, otherwise answer \"no\".");
    line("Question: {$numberToAsk}");
    $answer = prompt("Your answer");    

    if($answer !== $correctAnswer) {
        printWrongAnswerMessage($name, $correctAnswer, $wrongAnswer);
        return false;
    } else {
        printCorrectAnswerMessage();
        return true;
    }
}

function printWrongAnswerMessage(string $name, string $correctAnswer, string $wrongAnswer): void {
    line("'{$wrongAnswer}' is wrong answer ;(. Correct answer was '{$correctAnswer}'.");
    line("Let's try again, {$name}");
}

function printCorrectAnswerMessage():void {
    line("Correct!");
}

function printWinMessage(string $name):void {
    line("Congratulations, {$name}!");
}